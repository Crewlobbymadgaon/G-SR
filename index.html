
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>G&SR</title>

<style>
:root{
  --bg:#f6f9ff;
  --card:#fff;
  --kr:#0b63d6;
  --kr2:#0b9cff;
  --header-h:64px;
  --footer-h:60px;
  --desktop-break:980px;
  --page-max-width:1200px;
  --base-font: Inter, system-ui, Arial, serif;
}

*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:var(--base-font);
  background:var(--bg);
}

header{
  position:fixed;top:0;left:0;right:0;
  height:var(--header-h);
  display:flex;align-items:center;
  padding:0 14px;
  background:linear-gradient(90deg,var(--kr),var(--kr2));
  color:#fff;
  z-index:1000;
}

.brand{flex:1;text-align:center;font-weight:800}
.icon-btn{
  width:40px;height:40px;
  border-radius:8px;
  background:rgba(255,255,255,.15);
  border:0;color:#fff;
  font-size:18px;cursor:pointer;
}

main{
  padding:calc(var(--header-h) + 12px) 16px
          calc(var(--footer-h) + 16px);
  max-width:var(--page-max-width);
  margin:0 auto;
}

#cover{
  height:60vh;
  background:#111;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:14px;
}

#reader{display:none}

.page-shell{
  display:none;
}

.book-page{
  background:#fff;
  border-radius:10px;
  height:calc(100vh - var(--header-h) - var(--footer-h) - 24px);
  overflow:auto;
  padding:20px;
}

.chapter{
  max-width:900px;
  margin:0 auto;
  line-height:1.6;
}

footer{
  position:fixed;
  bottom:0;left:0;right:0;
  height:var(--footer-h);
  display:flex;
  justify-content:center;
  gap:20px;
  background:#fff;
  border-top:1px solid #ddd;
}

footer button{
  padding:6px 12px;
  font-weight:700;
  border-radius:8px;
  border:1px solid #ccc;
  background:#fff;
  cursor:pointer;
}

#tocDrawer{
  position:fixed;
  left:10px;
  top:80px;
  width:300px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
  padding:10px;
  display:none;
  z-index:1200;
}
#tocDrawer.open{display:block}

.toc-item,.toc-sub{
  padding:6px 8px;
  cursor:pointer;
  font-weight:700;
}
.toc-sub{padding-left:24px}

@media(min-width:980px){
  .page-shell{display:flex;justify-content:center}
  .book-page{width:100%}
}
</style>
</head>

<body>

<header>
  <button id="btnMenu" class="icon-btn">☰</button>
  <div class="brand">G&SR — Konkan Railway</div>
</header>

<nav id="tocDrawer">
  <div id="tocList"></div>
</nav>

<main>
  <section id="cover">G&SR Rule Book</section>

  <section id="reader">
    <div class="page-shell">
      <div class="book-page">
        <div class="chapter" id="chapterContainer"></div>
      </div>
    </div>
  </section>
</main>

<footer>
  <button id="prevBtn">◀</button>
  <button id="nextBtn">▶</button>
</footer>

<script>
const DESKTOP = 980;

const TOC = [
  {type:'fragment',id:'notification',label:'Notification'},
  {type:'fragment',id:'resolution',label:'Resolution'},
  {type:'chapter',id:'ch1',label:'CHAPTER I — PRELIMINARY',children:[
    {anchor:'s101',label:'1.01 Short title'},
    {anchor:'s102',label:'1.02 Definitions'}
  ]},
  {type:'chapter',id:'ch2',label:'Chapter II'}
];

const FLAT=[];
TOC.forEach(i=>{
  if(i.type==='fragment') FLAT.push({k:'f',id:i.id});
  if(i.type==='chapter'){
    FLAT.push({k:'c',id:i.id});
    (i.children||[]).forEach(a=>FLAT.push({k:'a',c:i.id,a:a.anchor}));
  }
});

const cover=document.getElementById('cover');
const reader=document.getElementById('reader');
const container=document.getElementById('chapterContainer');
const tocDrawer=document.getElementById('tocDrawer');
const tocList=document.getElementById('tocList');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
const btnMenu=document.getElementById('btnMenu');

let idx=-1;

/* Build TOC */
TOC.forEach(it=>{
  const d=document.createElement('div');
  d.className='toc-item';
  d.textContent=it.label;
  d.onclick=()=>open(it);
  tocList.appendChild(d);
  (it.children||[]).forEach(c=>{
    const s=document.createElement('div');
    s.className='toc-sub';
    s.textContent=c.label;
    s.onclick=()=>openAnchor(it.id,c.anchor);
    tocList.appendChild(s);
  });
});

btnMenu.onclick=()=>tocDrawer.classList.toggle('open');

/* Load helpers */
async function loadHtml(path){
  const r=await fetch(path);
  return r.ok ? r.text() : `<p>Missing ${path}</p>`;
}

/* Open logic */
function open(it){
  tocDrawer.classList.remove('open');
  if(it.type==='fragment') openFragment(it.id);
  else openChapter(it.id,null);
}
function openAnchor(id,a){openChapter(id,a)}

async function openFragment(id){
  const html=await loadHtml(`fragments/${id}.html`);
  showReader();
  container.innerHTML=html;
  idx=FLAT.findIndex(x=>x.k==='f'&&x.id===id);
  updateNav();
}

async function openChapter(id,anchor){
  const html=await loadHtml(`chapters/${id}.html`);
  showReader();
  container.innerHTML=html;
  if(anchor){
    setTimeout(()=>{
      const el=document.getElementById(anchor);
      if(el) el.scrollIntoView({behavior:'smooth'});
    },50);
  }
  idx=FLAT.findIndex(x=>x.k==='c'&&x.id===id);
  updateNav();
}

function showReader(){
  cover.style.display='none';
  reader.style.display='block';
}

function updateNav(){
  prevBtn.disabled=idx<=0;
  nextBtn.disabled=idx>=FLAT.length-1;
}

prevBtn.onclick=()=>{ if(idx>0) go(FLAT[idx-1]) };
nextBtn.onclick=()=>{ if(idx<FLAT.length-1) go(FLAT[idx+1]) };

function go(it){
  if(it.k==='f') openFragment(it.id);
  if(it.k==='c') openChapter(it.id,null);
  if(it.k==='a') openChapter(it.c,it.a);
}
</script>

</body>
</html>
